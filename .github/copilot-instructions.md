# Real Estate Platform - Agent Onboarding Instructions

## Project Overview
This is a full-stack real estate platform enabling property owners to list properties and customers to browse, order, and inquire about properties. The platform includes admin dashboards, property ratings, user profiles, shopping carts, and order management with email notifications.

## Tech Stack

### Backend
- **Framework**: ASP.NET Core Web API (.NET 8.0)
- **Database**: SQL Server
- **ORM**: Entity Framework Core
- **Logging**: NLog with email support
- **Email**: MailKit (Gmail SMTP)
- **Mapping**: AutoMapper
- **API Documentation**: Swagger UI
- **Architecture**: Layered (Controllers → Services → Repository → Entities)

### Frontend
- **Framework**: Angular 21.1.4
- **Language**: TypeScript 5.9
- **UI Library**: PrimeNG 21.1.1 with PrimeFlex CSS grid
- **State Management**: RxJS 7.8
- **Testing**: Vitest 4.0.8, Jasmine
- **Styling**: SCSS with purple gradient design system
- **Package Manager**: npm 11.8.0

## Project Structure

```
Real-Estate-Backend/
├── WebApiShop/              # ASP.NET Core API (main entry point)
│   ├── Controllers/         # 8 API controllers (Users, Products, Orders, etc.)
│   ├── Middleware/          # Custom middleware (error handling, admin auth, rating)
│   ├── Program.cs           # Dependency injection & configuration
│   ├── appsettings.json     # Connection strings & email config
│   └── nlog.config          # Logging configuration
├── Services/                # Business logic layer
│   ├── AutoMapping.cs       # AutoMapper profiles for DTO ↔ Entity
│   └── *Service.cs          # Service implementations (async patterns)
├── Repository/              # Data access layer
│   ├── ShopContext.cs       # EF Core DbContext with 8 entities
│   └── *Repository.cs       # Repository pattern implementations
├── Entities/                # Domain models (auto-generated by EF Core)
├── DTOs/                    # Data Transfer Objects (30+ DTO classes)
└── TestProject/             # xUnit tests for services

Real-Estate-Frontend/
├── src/app/
│   ├── component/           # 20+ feature components
│   ├── services/            # API client services
│   ├── guards/              # Route guards (admin guard)
│   ├── models/              # TypeScript interfaces
│   ├── app.routes.ts        # Route definitions
│   └── app.config.ts        # Global configuration
├── angular.json             # Angular CLI config
├── package.json             # npm dependencies
└── DESIGN_SYSTEM.md         # UI color palette & guidelines
```

## Core Entities
- `User`: Registered users (owners & customers) with authentication
- `Product`: Real estate properties with title, description, price, location, rooms/beds
- `Category`: Property types/classifications
- `Order`: Customer purchases with status tracking
- `OrderItem`: Line items in orders
- `ProductImage`: Multi-image support per property
- `Rating`: User ratings for properties
- `PropertyInquiry`: Customer inquiries about properties
- `AdminInquiry`: Admin-related inquiries

## Coding Guidelines

### Backend (.NET/C#)
1. **Async/Await**: All service/repository methods use `async Task`/`async Task<T>`
2. **Exception Handling**: Custom middleware (`ErrorHandlingMiddleware`) handles all exceptions uniformly
3. **Dependency Injection**: Services scoped via `builder.Services.AddScoped<I*, *>()`
4. **Authorization**: Middleware `AdminAuthorizationMiddleware` validates admin roles
5. **Email**: Use `IEmailService` for notifications (configured in `appsettings.json`)
6. **AutoMapper**: Map DTOs ↔ Entities in `AutoMapping.cs` profile
7. **Logging**: Use NLog for debug, info, error levels (see `nlog.config`)

### Frontend (Angular/TypeScript)
1. **Components**: Use `@Component` decorator with SCSS styling
2. **Services**: Inject via constructor, use RxJS Observables
3. **Routing**: Lazy load modules where applicable, guard admin routes with `adminGuard`
4. **State**: Use component-level RxJS subjects for state management
5. **Styling**: Follow DESIGN_SYSTEM.md for colors (purple gradient theme #667eea → #764ba2)
6. **HTTP**: Services use `HttpClient` with proper headers
7. **Testing**: Vitest for unit tests; follow pattern in existing .spec.ts files

## Build & Run Instructions

### Frontend Setup
```bash
cd Real-Estate-Frontend
npm install
ng serve                    # Runs on http://localhost:4200
ng build                    # Production build to dist/
ng test                     # Vitest unit tests
```

### Backend Setup
1. **Database**: Ensure SQL Server is running. Connection string in `appsettings.json`
2. **Build & Run**:
   ```bash
   cd Real-Estate-Backend
   dotnet build
   dotnet run --project WebApiShop/WebApiShop.csproj
   ```
3. **API Access**: Swagger UI at `https://localhost:{PORT}/swagger`

### Configuration
- **Frontend API Base**: `src/app/app.config.ts` (currently `http://localhost` + port)
- **CORS**: Backend allows `http://localhost:4200` only
- **Email**: Gmail SMTP config in `appsettings.json` (plaintext passwords - **SECURITY RISK** see Notes)
- **Database Connection**: `appsettings.json` contains hardcoded server name

## Key Tools & Resources

### Established Utilities
- **AutoMapper**: Map complex DTOs (40+ mappings defined in `AutoMapping.cs`)
- **NLog**: Email errors via `NLog.MailKit` configuration
- **PrimeNG**: Pre-built UI components (buttons, dialogs, tables, etc.)
- **PrimeFlex**: Responsive CSS grid system for layouts
- **Swagger**: Built-in API documentation (always enabled, toggle in `Program.cs`)

### Testing
- **Frontend**: `ng test` runs Vitest with jsdom environment
- **Backend**: Test project structure exists; add xUnit tests in `TestProject/`

### Scripts
- **Frontend**: `remove-console-logs.ps1` - PowerShell utility to strip console.log from TypeScript files
  ```powershell
  .\remove-console-logs.ps1
  ```

## Important Implementation Notes

### Database Relationships
- Products → Categories (many-to-one)
- Products → Users/Owner (many-to-one)
- Orders → OrderItems (one-to-many)
- OrderItems → Products (many-to-one)
- All auto-generated via EF Core Power Tools in `ShopContext.cs`

### API Conventions
- Base path: `/api/[controller]`
- All endpoints return wrapped responses via DTOs
- Admin-only endpoints validated by `AdminAuthorizationMiddleware`
- Exposed header: `IsAdmin` indicates user role

### Authentication
- No JWT/OAuth visible in current setup - investigate `UsersController` for login flow
- Admin check via middleware before admin endpoints
- User roles not explicitly shown in entities

## Common Failure Prevention

1. **Connection Strings**: Verify SQL Server instance name matches `appsettings.json`
   - Current: `Server = DESKTOP-TB3DT9H; Database = RealEstateDB;`
   - Update if using different machine/instance

2. **CORS/Localhost**: Frontend runs on `http://localhost:4200`, backend must allow this port

3. **Email Config**: Credentials hardcoded in `appsettings.json` - use environment variables in production

4. **Middleware Order**: `Program.cs` registers `/swagger` → `/https redirect` → `/cors` → custom middleware

5. **Missing Packages**: Run `npm install` and `dotnet restore` before building

6. **Port Conflicts**: Ensure port 4200 (frontend) and API port (typically 443/5000) are available

## Testing a Sample Feature

When implementing new features:
1. Add entity to `Entities/` (if needed)
2. Create DTOs in `DTOs/`
3. Add mapping in `Services/AutoMapping.cs`
4. Create/update service interface in `Services/I*.cs`
5. Implement service in `Services/*Service.cs` (use async)
6. Create/update repository in `Repository/`
7. Add controller endpoint in `WebApiShop/Controllers/`
8. Generate frontend service in `src/app/services/`
9. Create/update component in `src/app/component/`
10. Test with `ng serve` and Swagger UI

---

**Last Updated**: February 2026 | **Version**: 1.0
